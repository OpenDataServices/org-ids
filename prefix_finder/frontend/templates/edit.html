{% extends 'base.html' %}
{% load static %}
{% load results %}
{% load i18n %}
{% block main_content %}
<script type="text/javascript" src="{% static 'js/jsoneditor.min.js'%}"></script>
<div class="panel panel-default">
  <div class="panel-heading">
    <ul class="list-inline clear-margin-bottom">
      <h4>Suggested edits for <a href="{{org_list.url}}" data-toggle="tooltip" data-placement="top" title="{{org_list.url}}">{{ org_list.name.en }} ({{ org_list.code }})</a></h4>
    </ul>
  </div>
  <div class="panel-body">
     {% if existing_edits = True %}

        {% if pull_request %}
          Your pull request was made and <a href="{{ pull_request.html_url }}">can be reviewed here</a>.
        {% else %}
            There are existing edits for this code. You can:
            <ul>
              <li>Make further edits below</li>
              <li><a href="/_preview_branch/{{ org_list.code }}" id="preview">Preview the changes</a></li>
              <li>Submit a <a href="/edit/{{ org_list.code }}?pull_request=true&period=standard" class="pull_request">pull request (standard period)</a> Submit a <a href="/edit/{{ org_list.code }}?pull_request=true&period=fast" class="pull_request">pull request (no delay)</a> </li>
            </ul>
        {% endif %}
   {% endif %}

    {{ message }}

    <hr/>

    <div id='editor_container'>

    </div>

    <script><!--
        var element = document.getElementById('editor_container');
        var editor = new JSONEditor(element,{ajax:true, schema:{"$ref":"{% static 'js/list-schema-temp.json'%}"},startval:{{ org_json|safe }},theme:'bootstrap3',disable_edit_json:false,disable_collapse:true,disable_properties:false,iconlib:"bootstrap3",display_required_only:false })
        editor.on('change',function() {
             document.getElementById('json_data').value = JSON.stringify(editor.getValue(),null,2) // Do something
        }) ;    

        $(function() {
          $(".pull_request").click(function() { message = prompt("Please enter an optional commit message", "");  $(this).attr("href",$(this).attr("href") + "&message=" + encodeURIComponent(message));  } )
        }) 

    --></script>
  
    <hr/>
    <form action="{{ request.get_full_path }}" method="post">
      {% csrf_token %}
      <textarea name="json_data" id="json_data" style="width:100%; height:300px;" READONLY hidden></textarea>  
      <input type="text" name="sha" id="sha" value="{{ sha }}" READONLY hidden>
      <input type="submit" name="submit" value="Save changes">

    </form>
  </div>
</div>
{% endblock %}
